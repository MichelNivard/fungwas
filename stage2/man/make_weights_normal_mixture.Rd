% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/weight-functions.R
\name{make_weights_normal_mixture}
\alias{make_weights_normal_mixture}
\title{Build tau-by-K weights for a 2-component Normal mixture}
\usage{
make_weights_normal_mixture(
  taus,
  q_tau,
  p1,
  mu1,
  sd1,
  mu2,
  sd2,
  include_membership = FALSE,
  tiny = 1e-12
)
}
\arguments{
\item{taus}{Numeric vector of quantile levels.}

\item{q_tau}{Numeric vector of baseline quantiles at \code{taus} (\code{type=8} recommended).}

\item{p1}{Proportion of class 1 in (0,1); class 2 is \code{1 - p1}.}

\item{mu1, sd1}{Mean and standard deviation of component 1.}

\item{mu2, sd2}{Mean and standard deviation of component 2.}

\item{include_membership}{Logical; include a first column \code{"gamma"} if TRUE.}

\item{tiny}{Small positive floor for stabilizing divisions (default: mixture pdf clamped to \code{tiny}).}
}
\value{
A numeric matrix (\code{T x K}) with column names:
\itemize{
\item If \code{include_membership = FALSE}: \code{c("beta_1","beta_2")}
\item Else: \code{c("gamma","beta_1","beta_2")}
}
}
\description{
Constructs a weight matrix \eqn{W} that maps RIF tau-slopes \eqn{b(\tau)}
into component-parameter effects under a two-Normal mixture baseline.
}
\details{
Let \eqn{Y \sim p_1 N(\mu_1, \sigma_1^2) + (1-p_1) N(\mu_2, \sigma_2^2)}.
For baseline unconditional quantiles \eqn{q_\tau} and mixture pdf
\eqn{f(q_\tau)}, the default columns of \eqn{W} correspond to component means:
\deqn{W_1(\tau) = \frac{p_1 f_1(q_\tau)}{f(q_\tau)}, \quad
      W_2(\tau) = \frac{(1-p_1) f_2(q_\tau)}{f(q_\tau)}}

If \code{include_membership = TRUE}, a first column is added for membership
(log-odds) perturbation:
\deqn{W_\gamma(\tau) = - \frac{p_1 (1-p_1)}{f(q_\tau)}
      \left\{F_1(q_\tau) - F_2(q_\tau)\right\}}
}
\examples{
taus <- seq(0.10, 0.90, by = 0.05)
y <- rnorm(2000, 2, 1)
q_tau <- as.numeric(quantile(y, taus, type = 8))
W <- make_weights_normal_mixture(
  taus, q_tau,
  p1 = 0.5, mu1 = 1.2, sd1 = 0.45,
  mu2 = 3.0, sd2 = 0.7,
  include_membership = TRUE
)
dim(W); colnames(W)

}
